<!DOCTYPE html>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDlm7Ddtw63rhN4EtxtIKy9Q42cQjerozQ",
            authDomain: "test-77bc4.firebaseapp.com",
            projectId: "test-77bc4",
            storageBucket: "test-77bc4.appspot.com",
            messagingSenderId: "44373181938",
            appId: "1:44373181938:web:28acb82ab8fe0641dfd76b",
            measurementId: "G-MVBLB69MP0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let products = [
            { name: "人參", price: 500, image: "人參.jpg" },
            { name: "枸杞", price: 300, image: "枸杞.jpg" },
            { name: "甘草", price: 250, image: "甘草.jpg" },
            { name: "當歸", price: 400, image: "當歸.jpg" },
            { name: "靈芝", price: 600, image: "靈芝.jpg" },
            { name: "黨參", price: 450, image: "黨參.jpg" }
        ];
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        
        function addToCart(index) {
            let product = products[index];
            let existingItem = cart.find(item => item.name === product.name);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
        }
        
        function updateCart() {
            localStorage.setItem("cart", JSON.stringify(cart));
            let cartList = document.getElementById("cart-items");
            let totalPrice = 0;
            cartList.innerHTML = "";
            cart.forEach((item, index) => {
                totalPrice += item.price * item.quantity;
                let li = document.createElement("li");
                li.innerHTML = `${item.name} × ${item.quantity} - $${item.price * item.quantity}` +
                    `<div class='quantity-controls'>
                        <button onclick='changeQuantity(${index}, -1)'>-</button>
                        <span>${item.quantity}</span>
                        <button onclick='changeQuantity(${index}, 1)'>+</button>
                    </div>`;
                cartList.appendChild(li);
            });
            document.getElementById("total-price").textContent = totalPrice;
        }
        
        function changeQuantity(index, delta) {
            if (cart[index].quantity + delta <= 0) {
                cart.splice(index, 1);
            } else {
                cart[index].quantity += delta;
            }
            updateCart();
        }
        
        async function goToCheckout() {
            if (cart.length === 0) {
                alert("您的購物車是空的！");
                return;
            }
            
            const orderData = {
                cart: cart,
                total: document.getElementById("total-price").textContent,
                timestamp: new Date()
            };
            
            try {
                const docRef = await addDoc(collection(db, "pending_orders"), orderData);
                localStorage.setItem("orderId", docRef.id);
                localStorage.removeItem("cart");
                window.location.href = "訂單確認.html";
            } catch (error) {
                alert("提交訂單失敗: " + error.message);
            }
        }
        
        function loadProducts() {
            let productList = document.getElementById("product-list");
            products.forEach((product, index) => {
                let div = document.createElement("div");
                div.className = "product-item";Div.ClassName =“ product-item”;
                div.innerHTML = `<img src='${product.image}' alt='${product.name}'>
                                 <h3>${product.name}</h3>
                                 <p>$${product.price}</p>
                                 <button class='order-button' onclick='addToCart(${index})'>加入購物車</button>`;
                productList.appendChild(div);
            });
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            loadProducts();
            updateCart();
        });
    </script>
    <div class="return-box">
        <a href="index.html">返回主頁</a>
    </div>
</body>
</html>

